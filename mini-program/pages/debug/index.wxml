<!--pages/debug/index.wxml-->
<view wx:if="{{isVisible}}" class="container">
  <!-- è°ƒè¯•å¤´éƒ¨ -->
  <view class="debug-header">
    <view class="header-title">
      <text class="title-text">ğŸ”§ å¼€å‘è°ƒè¯•é¢æ¿</text>
      <text class="subtitle-text">æ€§èƒ½ç›‘æ§ & é”™è¯¯è¯Šæ–­</text>
    </view>
    <view class="header-actions">
      <view class="action-btn" bindtap="onRefresh">
        <text class="action-icon">ğŸ”„</text>
      </view>
      <view class="action-btn" bindtap="onCopyDebugInfo">
        <text class="action-icon">ğŸ“‹</text>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾æ  -->
  <scroll-view class="tabs-scroll" scroll-x>
    <view class="tabs-list">
      <view 
        wx:for="{{tabs}}" 
        wx:key="id"
        class="tab-item {{activeTab === item.id ? 'active' : ''}}"
        data-tab="{{item.id}}"
        bindtap="onTabTap"
      >
        <text class="tab-icon">{{item.icon}}</text>
        <text class="tab-name">{{item.name}}</text>
      </view>
    </view>
  </scroll-view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <scroll-view class="content-scroll" scroll-y>
    <!-- æ€§èƒ½ç›‘æ§ -->
    <view wx:if="{{activeTab === 'performance'}}" class="tab-content">
      <view wx:if="{{performanceData}}" class="performance-panel">
        <!-- é¡µé¢æ€§èƒ½ -->
        <view class="panel-section card">
          <view class="card-body">
            <view class="section-header">
              <text class="section-title">ğŸ“± é¡µé¢æ€§èƒ½</text>
            </view>
            <view class="metrics-grid">
              <view wx:for="{{performanceData.pagePerformance}}" wx:key="index" class="metric-item">
                <text class="metric-label">{{index}}</text>
                <text class="metric-value">{{item.avgLoadTime}}ms</text>
              </view>
            </view>
          </view>
        </view>

        <!-- ç”¨æˆ·è¡Œä¸º -->
        <view class="panel-section card">
          <view class="card-body">
            <view class="section-header">
              <text class="section-title">ğŸ‘¤ ç”¨æˆ·è¡Œä¸º</text>
            </view>
            <view class="behavior-stats">
              <text class="stat-text">æ€»æ“ä½œ: {{performanceData.userBehavior.totalActions}}</text>
              <text class="stat-text">æœ€åæ“ä½œ: {{performanceData.userBehavior.lastAction.action || 'æ— '}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- APIç›‘æ§ -->
    <view wx:if="{{activeTab === 'api'}}" class="tab-content">
      <view wx:if="{{apiMetrics}}" class="api-panel">
        <view class="panel-section card">
          <view class="card-body">
            <view class="section-header">
              <text class="section-title">ğŸ”Œ APIç»Ÿè®¡</text>
            </view>
            <view class="api-stats">
              <view class="stat-item">
                <text class="stat-label">æ€»è¯·æ±‚</text>
                <text class="stat-value">{{apiMetrics.apiCalls}}</text>
              </view>
              <view class="stat-item">
                <text class="stat-label">ç¼“å­˜å‘½ä¸­ç‡</text>
                <text class="stat-value">{{apiMetrics.cacheHitRate}}%</text>
              </view>
              <view class="stat-item">
                <text class="stat-label">é”™è¯¯æ¬¡æ•°</text>
                <text class="stat-value">{{apiMetrics.errors}}</text>
              </view>
              <view class="stat-item">
                <text class="stat-label">æ´»åŠ¨è¯·æ±‚</text>
                <text class="stat-value">{{apiMetrics.activeRequests}}</text>
              </view>
            </view>
            
            <view class="api-actions">
              <button class="debug-btn" bindtap="testApiConnection">æµ‹è¯•è¿æ¥</button>
              <button class="debug-btn" bindtap="stressTest">å‹åŠ›æµ‹è¯•</button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç¼“å­˜ç®¡ç† -->
    <view wx:if="{{activeTab === 'cache'}}" class="tab-content">
      <view wx:if="{{cacheInfo}}" class="cache-panel">
        <view class="panel-section card">
          <view class="card-body">
            <view class="section-header">
              <text class="section-title">ğŸ’¾ ç¼“å­˜ç»Ÿè®¡</text>
            </view>
            <view class="cache-stats">
              <view class="stat-item">
                <text class="stat-label">å­˜å‚¨ä½¿ç”¨</text>
                <text class="stat-value">{{cacheInfo.storageSize}} / {{cacheInfo.storageLimit}}</text>
              </view>
              <view class="stat-item">
                <text class="stat-label">ä½¿ç”¨ç‡</text>
                <text class="stat-value">{{cacheInfo.storageUsage}}%</text>
              </view>
              <view class="stat-item">
                <text class="stat-label">å†…å­˜ç¼“å­˜</text>
                <text class="stat-value">{{cacheInfo.memoryCache}} é¡¹</text>
              </view>
              <view class="stat-item">
                <text class="stat-label">å­˜å‚¨é”®æ•°</text>
                <text class="stat-value">{{cacheInfo.keys}}</text>
              </view>
            </view>
            
            <view class="cache-actions">
              <button class="debug-btn" bindtap="clearAllCache">æ¸…é™¤ç¼“å­˜</button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- é”™è¯¯ç›‘æ§ -->
    <view wx:if="{{activeTab === 'errors'}}" class="tab-content">
      <view wx:if="{{errorInfo}}" class="error-panel">
        <view class="panel-section card">
          <view class="card-body">
            <view class="section-header">
              <text class="section-title">ğŸ› é”™è¯¯ç»Ÿè®¡</text>
            </view>
            <view class="error-stats">
              <view class="stat-item {{errorInfo.totalErrors > 0 ? 'error' : ''}}">
                <text class="stat-label">æ€»é”™è¯¯æ•°</text>
                <text class="stat-value">{{errorInfo.totalErrors}}</text>
              </view>
              <view class="stat-item {{errorInfo.criticalErrors > 0 ? 'critical' : ''}}">
                <text class="stat-label">å…³é”®é”™è¯¯</text>
                <text class="stat-value">{{errorInfo.criticalErrors}}</text>
              </view>
            </view>
            
            <view wx:if="{{errorInfo.lastError}}" class="last-error">
              <text class="error-title">æœ€è¿‘é”™è¯¯:</text>
              <text class="error-message">{{errorInfo.lastError.message}}</text>
              <text class="error-time">{{errorInfo.lastError.timestamp}}</text>
            </view>
            
            <view class="error-actions">
              <button class="debug-btn" bindtap="simulateError">æ¨¡æ‹Ÿé”™è¯¯</button>
              <button class="debug-btn" bindtap="resetMonitorData">é‡ç½®æ•°æ®</button>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç³»ç»Ÿä¿¡æ¯ -->
    <view wx:if="{{activeTab === 'system'}}" class="tab-content">
      <view wx:if="{{systemInfo}}" class="system-panel">
        <view class="panel-section card">
          <view class="card-body">
            <view class="section-header">
              <text class="section-title">âš™ï¸ ç³»ç»Ÿä¿¡æ¯</text>
            </view>
            <view class="system-info">
              <view class="info-group">
                <text class="group-title">åº”ç”¨ä¿¡æ¯</text>
                <view class="info-item">
                  <text class="info-label">ç‰ˆæœ¬</text>
                  <text class="info-value">{{systemInfo.appVersion}}</text>
                </view>
                <view class="info-item">
                  <text class="info-label">ç¯å¢ƒ</text>
                  <text class="info-value">{{systemInfo.environment}}</text>
                </view>
                <view class="info-item">
                  <text class="info-label">APIåœ°å€</text>
                  <text class="info-value">{{systemInfo.apiBaseUrl}}</text>
                </view>
              </view>
              
              <view class="info-group">
                <text class="group-title">è®¾å¤‡ä¿¡æ¯</text>
                <view class="info-item">
                  <text class="info-label">ç³»ç»Ÿ</text>
                  <text class="info-value">{{systemInfo.system}}</text>
                </view>
                <view class="info-item">
                  <text class="info-label">å¾®ä¿¡ç‰ˆæœ¬</text>
                  <text class="info-value">{{systemInfo.version}}</text>
                </view>
                <view class="info-item">
                  <text class="info-label">å±å¹•å°ºå¯¸</text>
                  <text class="info-value">{{systemInfo.screenWidth}}x{{systemInfo.screenHeight}}</text>
                </view>
              </view>
            </view>
            
            <view class="system-actions">
              <button class="debug-btn" bindtap="switchEnvironment">åˆ‡æ¢ç¯å¢ƒ</button>
            </view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>
</view>

<!-- éå¼€å‘ç¯å¢ƒæç¤º -->
<view wx:else class="not-dev-notice">
  <view class="notice-content card">
    <view class="card-body">
      <view class="notice-icon">ğŸš«</view>
      <view class="notice-title">è°ƒè¯•é¢æ¿ä¸å¯ç”¨</view>
      <view class="notice-desc">è¯·åˆ‡æ¢åˆ°å¼€å‘ç¯å¢ƒåå†ä½¿ç”¨è°ƒè¯•åŠŸèƒ½</view>
    </view>
  </view>
</view>
