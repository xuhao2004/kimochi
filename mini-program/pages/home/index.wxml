<!--pages/home/index.wxml-->
<view class="container">
  <!-- å¤´éƒ¨ç”¨æˆ·ä¿¡æ¯ -->
  <view class="header-section">
    <view class="user-info glass" bindtap="onUserInfoTap">
      <view class="user-avatar">
        <image 
          wx:if="{{isLoggedIn && userInfo.avatar}}"
          src="{{userInfo.avatar}}" 
          class="avatar avatar-lg"
          mode="aspectFill"
        />
        <view wx:else class="avatar avatar-lg flex items-center justify-center">
          <text class="text-2xl">{{isLoggedIn ? userInfo.name.charAt(0) : 'ğŸ‘¤'}}</text>
        </view>
      </view>
      <view class="user-details">
        <view class="user-name">
          <text class="title-3">{{isLoggedIn ? userInfo.name : 'ç‚¹å‡»ç™»å½•'}}</text>
        </view>
        <view class="user-subtitle">
          <text class="text-secondary text-sm">
            {{isLoggedIn ? (userInfo.email || 'å·²ç™»å½•ç”¨æˆ·') : 'ç™»å½•åä½“éªŒå®Œæ•´åŠŸèƒ½'}}
          </text>
        </view>
      </view>
      <view class="header-actions">
        <view wx:if="{{unreadCount > 0}}" class="badge">{{unreadCount > 99 ? '99+' : unreadCount}}</view>
        <text class="text-tertiary">â€º</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥å¿ƒè¯­ -->
  <view class="section">
    <view class="card card-hover" bindtap="onDailyQuoteTap" bindlongpress="shareDailyQuote">
      <view class="card-body">
        <view class="flex items-center justify-between mb-3">
          <view class="flex items-center">
            <text class="text-lg mr-2">ğŸŒ¸</text>
            <text class="font-semibold">ä»Šæ—¥å¿ƒè¯­</text>
          </view>
          <text class="text-xs text-tertiary">ç‚¹å‡»åˆ·æ–°</text>
        </view>
        
        <view wx:if="{{dailyQuote}}" class="quote-content">
          <text class="text-base text-primary">{{dailyQuote}}</text>
        </view>
        <view wx:else class="quote-placeholder">
          <text class="text-secondary">è½»è§¦è·å–ä»Šæ—¥å¿ƒè¯­...</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¤©æ°”ä¿¡æ¯ -->
  <view wx:if="{{weather}}" class="section">
    <view class="card card-hover" bindtap="onWeatherTap">
      <view class="card-body">
        <view class="flex items-center justify-between">
          <view class="weather-info">
            <view class="flex items-center mb-1">
              <text class="text-lg mr-2">ğŸŒ¤ï¸</text>
              <text class="font-semibold">{{weather.locationName}}</text>
            </view>
            <view class="weather-details">
              <text class="text-2xl font-bold">{{weather.temperatureC}}Â°</text>
              <text class="text-sm text-secondary ml-2">{{weather.summary}}</text>
            </view>
          </view>
          <view class="weather-extra text-right">
            <view class="text-sm text-secondary">ä½“æ„Ÿ {{weather.feelsLikeC}}Â°</view>
            <view class="text-xs text-tertiary">æ¹¿åº¦ {{weather.humidity}}%</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="section">
    <view class="section-title mb-4">
      <text class="title-3">å¿«æ·å…¥å£</text>
    </view>
    <view class="grid grid-2">
      <view 
        wx:for="{{quickActions}}" 
        wx:key="id"
        class="feature-card card-hover fade-in"
        style="animation-delay: {{index * 0.1}}s"
        data-url="{{item.url}}"
        bindtap="onQuickActionTap"
      >
        <view class="feature-icon" style="background: {{item.color}}15; color: {{item.color}};">
          <text>{{item.icon}}</text>
        </view>
        <view class="feature-content">
          <view class="feature-title">{{item.title}}</view>
          <view class="feature-desc">{{item.desc}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- çƒ­é—¨åŠ¨æ€ -->
  <view wx:if="{{hotPosts.length > 0}}" class="section">
    <view class="section-title mb-4 flex items-center justify-between">
      <text class="title-3">çƒ­é—¨åŠ¨æ€</text>
      <text class="text-sm text-secondary" bindtap="onQuickActionTap" data-url="/pages/message-wall/index">æŸ¥çœ‹æ›´å¤š â€º</text>
    </view>
    
    <view class="posts-list">
      <view 
        wx:for="{{hotPosts}}" 
        wx:key="id"
        class="post-item card card-hover mb-3 fade-in"
        style="animation-delay: {{index * 0.1 + 0.3}}s"
        data-id="{{item.id}}"
        bindtap="onHotPostTap"
      >
        <view class="card-body">
          <view class="post-content">
            <text class="text-base">{{item._content}}</text>
          </view>
          <view class="post-meta flex items-center justify-between mt-3">
            <view class="flex items-center">
              <text class="text-xs text-tertiary">{{item._createdAt}}</text>
            </view>
            <view class="post-stats flex items-center">
              <view class="flex items-center mr-3">
                <text class="text-xs mr-1">â¤ï¸</text>
                <text class="text-xs text-secondary">{{item.likeCount || 0}}</text>
              </view>
              <text class="text-xs text-tertiary">â€º</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨ç©ºé—´ -->
  <view class="safe-area"></view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view wx:if="{{isLoading}}" class="loading-overlay">
  <view class="loading-content glass">
    <view class="loading-spinner"></view>
    <text class="text-sm text-secondary mt-3">åŠ è½½ä¸­...</text>
  </view>
</view>

<!-- ä¸‹æ‹‰åˆ·æ–°æŒ‡ç¤ºå™¨ -->
<view wx:if="{{refreshing}}" class="refresh-indicator">
  <view class="loading-spinner"></view>
</view>
