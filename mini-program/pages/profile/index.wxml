<!--pages/profile/index.wxml-->
<view class="container">
  <!-- 用户信息区域 -->
  <view class="profile-header">
    <view wx:if="{{isLoggedIn}}" class="user-profile glass" bindtap="onEditProfile" bindlongpress="onUserInfoLongPress">
      <view class="user-avatar-section">
        <image 
          class="user-avatar avatar avatar-xl"
          src="{{userInfo.avatar || '/assets/default/avatar.png'}}"
          mode="aspectFill"
          bindtap="onAvatarTap"
        />
        <view class="edit-avatar-hint">
          <text class="edit-icon">📷</text>
        </view>
      </view>
      
      <view class="user-info">
        <view class="user-name">
          <text class="title-2">{{userInfo.name}}</text>
        </view>
        <view class="user-email">
          <text class="text-secondary">{{userInfo.email}}</text>
        </view>
        <view class="user-status">
          <view class="status-badge {{userInfo.role === 'ADMIN' ? 'admin' : 'user'}}">
            {{userInfo.role === 'ADMIN' ? '管理员' : '用户'}}
          </view>
        </view>
      </view>
      
      <view class="profile-arrow">
        <text class="arrow-icon">›</text>
      </view>
    </view>

    <!-- 未登录状态 -->
    <view wx:else class="login-profile glass" bindtap="onLogin">
      <view class="login-avatar">
        <text class="login-avatar-icon">👤</text>
      </view>
      <view class="login-info">
        <view class="login-title">点击登录</view>
        <view class="login-subtitle">体验完整功能</view>
      </view>
      <view class="login-arrow">
        <text class="arrow-icon">›</text>
      </view>
    </view>
  </view>

  <!-- 统计数据 -->
  <view wx:if="{{isLoggedIn}}" class="stats-section">
    <view class="stats-card card">
      <view class="card-body">
        <view class="stats-grid">
          <view 
            class="stat-item"
            data-type="assessmentCount"
            bindtap="onStatTap"
          >
            <text class="stat-value">{{stats.assessmentCount}}</text>
            <text class="stat-label">测评</text>
          </view>
          <view class="stat-divider"></view>
          <view 
            class="stat-item"
            data-type="postCount"
            bindtap="onStatTap"
          >
            <text class="stat-value">{{stats.postCount}}</text>
            <text class="stat-label">动态</text>
          </view>
          <view class="stat-divider"></view>
          <view 
            class="stat-item"
            data-type="friendCount"
            bindtap="onStatTap"
          >
            <text class="stat-value">{{stats.friendCount}}</text>
            <text class="stat-label">好友</text>
          </view>
          <view class="stat-divider"></view>
          <view 
            class="stat-item"
            data-type="messageCount"
            bindtap="onStatTap"
          >
            <text class="stat-value">{{stats.messageCount}}</text>
            <text class="stat-label">消息</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 最近活动 -->
  <view wx:if="{{isLoggedIn && recentActivities.length > 0}}" class="activities-section">
    <view class="section-header">
      <text class="section-title">最近活动</text>
    </view>
    
    <view class="activities-list">
      <view 
        wx:for="{{recentActivities}}" 
        wx:key="id"
        class="activity-item card card-hover fade-in"
        style="animation-delay: {{index * 0.1}}s"
        data-activity="{{item}}"
        bindtap="onActivityTap"
      >
        <view class="card-body">
          <view class="activity-content">
            <view class="activity-icon">{{item.icon}}</view>
            <view class="activity-info">
              <text class="activity-title">{{item.title}}</text>
              <text class="activity-time">{{item._time}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 功能菜单 -->
  <view class="menu-section">
    <view class="menu-list">
      <view 
        wx:for="{{menuItems}}" 
        wx:key="id"
        class="menu-item card card-hover fade-in"
        style="animation-delay: {{index * 0.05 + 0.2}}s"
        data-item="{{item}}"
        bindtap="onMenuItemTap"
      >
        <view class="card-body">
          <view class="menu-content">
            <view class="menu-icon">{{item.icon}}</view>
            <view class="menu-info">
              <view class="menu-title">{{item.title}}</view>
              <view class="menu-desc">{{item.desc}}</view>
            </view>
            <view class="menu-arrow">›</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 操作区域 -->
  <view class="actions-section">
    <view wx:if="{{isLoggedIn}}" class="action-buttons">
      <button class="action-btn secondary" bindtap="onShareApp">
        分享应用
      </button>
      <button class="action-btn secondary" bindtap="onFeedback">
        意见反馈
      </button>
      <button class="action-btn danger" bindtap="onLogout">
        退出登录
      </button>
    </view>
    
    <view wx:else class="guest-actions">
      <button class="action-btn primary" bindtap="onLogin">
        立即登录
      </button>
      <button class="action-btn secondary" bindtap="onShareApp">
        分享应用
      </button>
    </view>
  </view>

  <!-- 版本信息 -->
  <view class="version-section">
    <text class="version-text">kimochi心晴 小程序版 v2.0.0</text>
    <view class="version-actions">
      <text class="version-link" bindtap="onCheckUpdate">检查更新</text>
      <text class="version-separator">•</text>
      <text class="version-link" bindtap="onAbout">关于应用</text>
    </view>
  </view>

  <!-- 底部安全区域 -->
  <view class="safe-area"></view>
</view>

<!-- 加载状态 -->
<view wx:if="{{isLoading}}" class="loading-overlay">
  <view class="loading-content glass">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>
</view>