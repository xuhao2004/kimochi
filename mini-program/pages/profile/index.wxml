<!--pages/profile/index.wxml-->
<view class="container">
  <!-- ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="profile-header">
    <view wx:if="{{isLoggedIn}}" class="user-profile glass" bindtap="onEditProfile" bindlongpress="onUserInfoLongPress">
      <view class="user-avatar-section">
        <image 
          class="user-avatar avatar avatar-xl"
          src="{{userInfo.avatar || '/assets/default/avatar.png'}}"
          mode="aspectFill"
          bindtap="onAvatarTap"
        />
        <view class="edit-avatar-hint">
          <text class="edit-icon">ğŸ“·</text>
        </view>
      </view>
      
      <view class="user-info">
        <view class="user-name">
          <text class="title-2">{{userInfo.name}}</text>
        </view>
        <view class="user-email">
          <text class="text-secondary">{{userInfo.email}}</text>
        </view>
        <view class="user-status">
          <view class="status-badge {{userInfo.role === 'ADMIN' ? 'admin' : 'user'}}">
            {{userInfo.role === 'ADMIN' ? 'ç®¡ç†å‘˜' : 'ç”¨æˆ·'}}
          </view>
        </view>
      </view>
      
      <view class="profile-arrow">
        <text class="arrow-icon">â€º</text>
      </view>
    </view>

    <!-- æœªç™»å½•çŠ¶æ€ -->
    <view wx:else class="login-profile glass" bindtap="onLogin">
      <view class="login-avatar">
        <text class="login-avatar-icon">ğŸ‘¤</text>
      </view>
      <view class="login-info">
        <view class="login-title">ç‚¹å‡»ç™»å½•</view>
        <view class="login-subtitle">ä½“éªŒå®Œæ•´åŠŸèƒ½</view>
      </view>
      <view class="login-arrow">
        <text class="arrow-icon">â€º</text>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ•°æ® -->
  <view wx:if="{{isLoggedIn}}" class="stats-section">
    <view class="stats-card card">
      <view class="card-body">
        <view class="stats-grid">
          <view 
            class="stat-item"
            data-type="assessmentCount"
            bindtap="onStatTap"
          >
            <text class="stat-value">{{stats.assessmentCount}}</text>
            <text class="stat-label">æµ‹è¯„</text>
          </view>
          <view class="stat-divider"></view>
          <view 
            class="stat-item"
            data-type="postCount"
            bindtap="onStatTap"
          >
            <text class="stat-value">{{stats.postCount}}</text>
            <text class="stat-label">åŠ¨æ€</text>
          </view>
          <view class="stat-divider"></view>
          <view 
            class="stat-item"
            data-type="friendCount"
            bindtap="onStatTap"
          >
            <text class="stat-value">{{stats.friendCount}}</text>
            <text class="stat-label">å¥½å‹</text>
          </view>
          <view class="stat-divider"></view>
          <view 
            class="stat-item"
            data-type="messageCount"
            bindtap="onStatTap"
          >
            <text class="stat-value">{{stats.messageCount}}</text>
            <text class="stat-label">æ¶ˆæ¯</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘æ´»åŠ¨ -->
  <view wx:if="{{isLoggedIn && recentActivities.length > 0}}" class="activities-section">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘æ´»åŠ¨</text>
    </view>
    
    <view class="activities-list">
      <view 
        wx:for="{{recentActivities}}" 
        wx:key="id"
        class="activity-item card card-hover fade-in"
        style="animation-delay: {{index * 0.1}}s"
        data-activity="{{item}}"
        bindtap="onActivityTap"
      >
        <view class="card-body">
          <view class="activity-content">
            <view class="activity-icon">{{item.icon}}</view>
            <view class="activity-info">
              <text class="activity-title">{{item.title}}</text>
              <text class="activity-time">{{item._time}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view class="menu-list">
      <view 
        wx:for="{{menuItems}}" 
        wx:key="id"
        class="menu-item card card-hover fade-in"
        style="animation-delay: {{index * 0.05 + 0.2}}s"
        data-item="{{item}}"
        bindtap="onMenuItemTap"
      >
        <view class="card-body">
          <view class="menu-content">
            <view class="menu-icon">{{item.icon}}</view>
            <view class="menu-info">
              <view class="menu-title">{{item.title}}</view>
              <view class="menu-desc">{{item.desc}}</view>
            </view>
            <view class="menu-arrow">â€º</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œåŒºåŸŸ -->
  <view class="actions-section">
    <view wx:if="{{isLoggedIn}}" class="action-buttons">
      <button class="action-btn secondary" bindtap="onShareApp">
        åˆ†äº«åº”ç”¨
      </button>
      <button class="action-btn secondary" bindtap="onFeedback">
        æ„è§åé¦ˆ
      </button>
      <button class="action-btn danger" bindtap="onLogout">
        é€€å‡ºç™»å½•
      </button>
    </view>
    
    <view wx:else class="guest-actions">
      <button class="action-btn primary" bindtap="onLogin">
        ç«‹å³ç™»å½•
      </button>
      <button class="action-btn secondary" bindtap="onShareApp">
        åˆ†äº«åº”ç”¨
      </button>
    </view>
  </view>

  <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
  <view class="version-section">
    <text class="version-text">kimochiå¿ƒæ™´ å°ç¨‹åºç‰ˆ v2.0.0</text>
    <view class="version-actions">
      <text class="version-link" bindtap="onCheckUpdate">æ£€æŸ¥æ›´æ–°</text>
      <text class="version-separator">â€¢</text>
      <text class="version-link" bindtap="onAbout">å…³äºåº”ç”¨</text>
    </view>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area"></view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view wx:if="{{isLoading}}" class="loading-overlay">
  <view class="loading-content glass">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>