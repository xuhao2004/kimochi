<!--pages/assessments/index.wxml-->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header-section">
    <view class="header-title">
      <text class="title-2">å¿ƒç†æµ‹è¯„</text>
      <text class="subtitle">äº†è§£å†…åœ¨çš„è‡ªå·±</text>
    </view>
    
    <view class="header-actions">
      <view class="action-btn" bindtap="onSearchToggle">
        <text class="icon">ğŸ”</text>
      </view>
      <view class="action-btn" bindtap="onQuickFilter">
        <text class="icon">âš™ï¸</text>
      </view>
      <view wx:if="{{isLoggedIn}}" class="action-btn" bindtap="onHistoryTap">
        <text class="icon">ğŸ“Š</text>
      </view>
    </view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view wx:if="{{showSearch}}" class="search-section fade-in">
    <view class="search-box">
      <view class="search-input-wrapper">
        <text class="search-icon">ğŸ”</text>
        <input 
          class="search-input"
          placeholder="æœç´¢æµ‹è¯„å†…å®¹..."
          value="{{searchText}}"
          bindinput="onSearchInput"
        />
        <view wx:if="{{searchText}}" class="clear-btn" bindtap="onSearchClear">
          <text>Ã—</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <view class="categories-section">
    <scroll-view class="categories-scroll" scroll-x>
      <view class="categories-list">
        <view 
          class="category-tag {{activeCategory === 'all' ? 'active' : ''}}"
          data-category="all"
          bindtap="onCategoryTap"
        >
          <text>å…¨éƒ¨</text>
        </view>
        <view 
          wx:for="{{categories}}" 
          wx:key="id"
          class="category-tag {{activeCategory === item.id ? 'active' : ''}}"
          style="--tag-color: {{item.color}}"
          data-category="{{item.id}}"
          bindtap="onCategoryTap"
        >
          <text class="category-icon">{{item.icon}}</text>
          <text class="category-name">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æµ‹è¯„åˆ—è¡¨ -->
  <view class="assessments-section">
    <view wx:if="{{!isLoading && filteredAssessments.length === 0}}" class="empty-state">
      <view class="empty-icon">ğŸ“</view>
      <view class="empty-text">æš‚æ— ç›¸å…³æµ‹è¯„</view>
      <view class="empty-desc">è¯•è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶</view>
    </view>

    <view wx:else class="assessments-list">
      <view 
        wx:for="{{filteredAssessments}}" 
        wx:key="id"
        class="assessment-card card card-hover fade-in"
        style="animation-delay: {{index * 0.1}}s"
        data-assessment="{{item}}"
        bindtap="onAssessmentTap"
        bindlongpress="onAssessmentDetail"
      >
        <!-- å®ŒæˆçŠ¶æ€æ ‡è¯† -->
        <view wx:if="{{item._isCompleted}}" class="completed-badge">
          <text>å·²å®Œæˆ</text>
        </view>

        <view class="card-body">
          <!-- æ ‡é¢˜åŒºåŸŸ -->
          <view class="assessment-header">
            <view class="assessment-title">
              <text class="title-3">{{item.title}}</text>
            </view>
            <view class="assessment-meta">
              <view class="meta-item">
                <text class="meta-icon">â±ï¸</text>
                <text class="meta-text">{{item._estimatedTime}}</text>
              </view>
              <view class="meta-item">
                <text 
                  class="difficulty-tag" 
                  style="color: {{item._difficulty.color}}; background: {{item._difficulty.color}}20"
                >
                  {{item._difficulty.text}}
                </text>
              </view>
            </view>
          </view>

          <!-- æè¿° -->
          <view class="assessment-description">
            <text class="text-secondary">{{item.description}}</text>
          </view>

          <!-- åº•éƒ¨ä¿¡æ¯ -->
          <view class="assessment-footer">
            <view class="assessment-stats">
              <view class="stat-item">
                <text class="stat-value">{{item.questionCount || 0}}</text>
                <text class="stat-label">é¢˜ç›®</text>
              </view>
              <view class="stat-item">
                <text class="stat-value">{{item.completedCount || 0}}</text>
                <text class="stat-label">å®Œæˆ</text>
              </view>
            </view>
            
            <view class="assessment-action">
              <view class="start-btn {{item._isCompleted ? 'retake' : 'new'}}">
                <text>{{item._isCompleted ? 'é‡æ–°æµ‹è¯•' : 'å¼€å§‹æµ‹è¯•'}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç™»å½•æç¤º -->
  <view wx:if="{{!isLoggedIn}}" class="login-prompt card mt-6">
    <view class="card-body text-center">
      <view class="prompt-icon">ğŸ”</view>
      <view class="prompt-title">ç™»å½•åä½“éªŒå®Œæ•´åŠŸèƒ½</view>
      <view class="prompt-desc">ä¿å­˜æµ‹è¯„ç»“æœï¼ŒæŸ¥çœ‹å†å²è®°å½•</view>
      <button class="btn btn-primary btn-small mt-3" bindtap="onLoginTap">ç«‹å³ç™»å½•</button>
    </view>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area"></view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view wx:if="{{isLoading}}" class="loading-overlay">
  <view class="loading-content glass">
    <view class="loading-spinner"></view>
    <text class="text-sm text-secondary mt-3">åŠ è½½æµ‹è¯„ä¸­...</text>
  </view>
</view>
