<view class="apple-page">
  <view class="apple-card" style="background:linear-gradient(135deg,#ffffff,#f7f8fa)">
    <view class="apple-title">消息中心</view>
    <view class="apple-p apple-muted">查看系统通知与站内消息</view>
    <view style="display:flex; gap:12rpx; margin-top:8rpx; flex-wrap:wrap;">
      <button class="apple-button" bindtap="filterAll">全部</button>
      <button class="apple-button" bindtap="filterUnread">未读</button>
      <button class="apple-button" bindtap="markAllRead">全部已读</button>
      <button class="apple-button" bindtap="toggleBatchMode">{{batchMode? '退出批量':'批量删除'}}</button>
    </view>
    <view style="display:flex; gap:12rpx; margin-top:8rpx; flex-wrap:wrap;">
      <button class="apple-button" bindtap="showAll">全部来源</button>
      <button class="apple-button" bindtap="showAdmin">系统通知</button>
      <button class="apple-button" bindtap="showUser">用户消息</button>
      <button class="apple-button" bindtap="sortByTime">按时间</button>
      <button class="apple-button" bindtap="sortByPriority">按优先级</button>
      <button class="apple-button" data-v="all" bindtap="setPriority">优先级:全部</button>
      <button class="apple-button" data-v="urgent" bindtap="setPriority">仅紧急</button>
      <button class="apple-button" data-v="high" bindtap="setPriority">仅高</button>
      <button class="apple-button" data-v="normal" bindtap="setPriority">仅中</button>
      <button class="apple-button" data-v="low" bindtap="setPriority">仅低</button>
    </view>
  </view>
  <view class="apple-section">
    <block wx:if="{{!messages.length}}">
      <view class="apple-card" style="margin-top:12rpx;">
        <view class="skeleton" style="height:24rpx;width:60%;margin-bottom:12rpx;"></view>
        <view class="skeleton" style="height:18rpx;width:90%;"></view>
      </view>
    </block>
    <block wx:for="{{messages}}" wx:key="id">
      <view class="apple-card fade-in" style="margin-top:12rpx; position:relative;">
        <checkbox wx:if="{{batchMode}}" style="position:absolute; right:16rpx; top:16rpx; transform:scale(0.9);" value="{{item.id}}" checked="{{selectedMap[item.id]}}" data-id="{{item.id}}" bindchange="onSelectItem" />
        <view class="apple-h2">{{item.title || '通知'}}</view>
        <view class="apple-p">{{item.content}}</view>
        <view class="apple-p apple-muted" style="margin-top:6rpx;">{{item._createdAt}} · {{item.source==='admin_message'?'系统':'用户'}}</view>
      </view>
    </block>
    <view wx:if="{{hasMore}}" style="display:flex; justify-content:center; margin:16rpx 0;">
      <button class="apple-button" bindtap="loadMore">加载更多</button>
    </view>
    <view wx:if="{{batchMode}}" style="position:sticky; bottom:0; padding:12rpx; background:#fff; display:flex; gap:12rpx;">
      <button class="apple-button" bindtap="deleteSelected">删除所选</button>
    </view>
  </view>
</view>

