<view class="apple-page">
  <view class="apple-card">
    <view class="apple-title">心情墙</view>
    <button class="apple-button apple-button-primary" bindtap="goCreate">发布心情</button>
  </view>
  <view class="apple-section">
    <block wx:if="{{!visiblePosts.length || loading}}">
      <view class="apple-card" style="margin-top:12rpx;">
        <view class="skeleton" style="height:28rpx;width:70%;margin-bottom:12rpx;"></view>
        <view class="skeleton" style="height:18rpx;width:95%;margin-bottom:8rpx;"></view>
        <view class="skeleton" style="height:18rpx;width:90%;"></view>
      </view>
    </block>
    <block wx:for="{{visiblePosts}}" wx:key="id">
      <view class="apple-card fade-in" style="margin-top:12rpx;background:linear-gradient(180deg,#fff, #fafafa);">
        <view class="apple-h2">{{item.title}}</view>
        <view class="apple-p">{{item._content}}</view>
        <view class="apple-p apple-muted" style="margin-top:8rpx;">{{item._createdAt}}</view>
        <view style="display:flex; gap:8rpx; flex-wrap:wrap; margin-top:6rpx;" wx:if="{{item._images && item._images.length}}">
          <block wx:for="{{item._images}}" wx:key="*this">
            <image src="{{item}}" style="width:160rpx;height:160rpx;border-radius:12rpx;" mode="aspectFill" />
          </block>
        </view>
        <view style="display:flex; gap:12rpx; margin-top:12rpx; align-items:center;">
          <button class="apple-button" data-id="{{item.id}}" bindtap="toggleLike">{{item._liked? '已赞':'点赞'}}</button>
          <view class="pill pill-muted">{{item.likeCount || 0}} 赞</view>
        </view>
      </view>
    </block>
    <view wx:if="{{hasMore}}" style="display:flex; justify-content:center; margin:16rpx 0;">
      <button class="apple-button" bindtap="loadMore">加载更多</button>
    </view>
  </view>
</view>

