<view class="apple-page" style="padding:24rpx;">
  <view class="apple-title">调试设置</view>
  <view class="apple-p apple-muted" style="margin-top:8rpx;">仅保存在本机，不影响其他用户</view>

  <view class="apple-card" style="margin-top:20rpx;">
    <view class="apple-h2">API 基址</view>
    <input class="apple-input" placeholder="例如：https://your-tunnel.example" placeholder-class="apple-placeholder" cursor-spacing="28" adjust-position="true" value="{{apiBase}}" bindinput="onApiBaseInput"/>
    <view class="apple-p apple-muted" style="margin-top:8rpx;">留空则使用默认： https://app.kimochi.space</view>
    <view style="display:flex; gap:12rpx; margin-top:12rpx;">
      <button class="apple-button" bindtap="clearApiBase">清除覆盖</button>
      <button class="apple-button apple-button-primary" bindtap="saveApiBase">保存</button>
      <button class="apple-button" bindtap="togglePresets">快速切换</button>
    </view>
    <view wx:if="{{presetsOpen}}" style="margin-top:12rpx; display:flex; flex-wrap:wrap; gap:12rpx;">
      <block wx:for="{{presets}}" wx:key="index">
        <button class="apple-button" data-index="{{index}}" bindtap="applyPreset">{{item.label}}</button>
      </block>
    </view>
  </view>

  <view class="apple-card" style="margin-top:20rpx;">
    <view class="apple-h2">选项</view>
    <view style="display:flex; align-items:center; justify-content:space-between; margin-top:8rpx;">
      <view class="apple-p">允许局域网 HTTP 覆盖</view>
      <switch checked="{{allowHttp}}" bindchange="onToggleHttp"/>
    </view>
    <view class="apple-p apple-muted">仅当你在真机上直连 192.168.x.x:端口 时需要打开</view>
    <view style="height:12rpx"/>
    <view style="display:flex; align-items:center; justify-content:space-between;">
      <view class="apple-p">401 自动登录后重试</view>
      <switch checked="{{autoLogin}}" bindchange="onToggleAutoLogin"/>
    </view>
    <view style="height:12rpx"/>
    <view style="display:flex; align-items:center; justify-content:space-between;">
      <view class="apple-p">启用开发特性（新功能灰度）</view>
      <switch checked="{{devFeatures}}" bindchange="onToggleDevFeatures"/>
    </view>
  </view>

  <view class="apple-card" style="margin-top:20rpx;">
    <view class="apple-h2">快速测试</view>
    <view class="apple-p apple-muted">请求 /api/violation-reasons 以验证连通性（无需登录）</view>
    <button class="apple-button apple-button-primary" style="margin-top:12rpx;" bindtap="testConnectivity">开始测试</button>
    <view class="apple-p" style="margin-top:8rpx; word-break:break-all;">{{testResult}}</view>
  </view>
</view>


